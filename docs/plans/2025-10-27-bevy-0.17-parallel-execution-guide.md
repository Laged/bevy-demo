# Bevy 0.17 Parallel Agent Execution Guide

**Date**: 2025-10-27
**Status**: Ready for Execution
**Parent Design**: [2025-10-27-bevy-0.17-parallel-integration-design.md](./2025-10-27-bevy-0.17-parallel-integration-design.md)

## Quick Start: Launch All Agents

### Step 1: Start with Gameplay Agent (Foundation)

**Worktree**: `.worktrees/gameplay-events`
**Plan**: [2025-10-27-gameplay-event-system-modernization.md](./2025-10-27-gameplay-event-system-modernization.md)
**Priority**: MUST complete first (provides event contracts for other agents)

```bash
cd /home/laged/Codings/laged/bevy-demo/.worktrees/gameplay-events

# Open new Claude Code session in this directory
# Then run: /superpowers:execute-plan
# Load plan: docs/plans/2025-10-27-gameplay-event-system-modernization.md
```

**Estimated time**: 4-6 hours
**Tasks**: 6 tasks (event contracts, collision modernization, player damage, enemy spawning, lifecycle observers, integration tests)

---

### Step 2: Launch Parallel UI & Graphics Agents

Once Gameplay Agent completes Task 0 (event contracts defined), these agents can start in parallel:

#### UI Agent - Phase 2: Headless Widgets

**Worktree**: `.worktrees/ui-widgets`
**Priority**: HIGH (enables pause menu, settings)

```bash
cd /home/laged/Codings/laged/bevy-demo/.worktrees/ui-widgets

# Implementation plan to create:
# - Pause menu with Button widgets
# - Settings panel with Sliders (volume, difficulty, particle count)
# - Wave selector stub (RadioButton/Checkbox)
# - Visual styling for standard mode
# - Headless tests for all interactions

# Key files:
# - src/domains/ui/pause_menu.rs (new)
# - src/domains/ui/settings_panel.rs (new)
# - tests/ui_widgets_test.rs (new)

# Events to trigger:
# - PauseMenuToggled (on button press)
# - SettingsChanged (on slider movement)
```

**Estimated time**: 4-6 hours

#### UI Agent - Phase 3: ViewportNode

**Worktree**: `.worktrees/ui-viewport`
**Priority**: HIGH (enables minimap)

```bash
cd /home/laged/Codings/laged/bevy-demo/.worktrees/ui-viewport

# Implementation plan to create:
# - Minimap camera system tracking player
# - Minimap UI node rendering via ViewportNode
# - Wave preview panel showing spawn positions
# - Headless tests for camera setup

# Key files:
# - src/domains/ui/minimap.rs (new)
# - src/domains/ui/wave_preview.rs (new)
# - src/domains/ui/hud.rs (integrate minimap)
# - tests/viewport_test.rs (new)

# Events to trigger:
# - MinimapCameraReady (when camera setup complete)
```

**Estimated time**: 3-4 hours

#### Graphics Agent - Phase 4: Tilemap

**Worktree**: `.worktrees/graphics-tilemap`
**Priority**: MEDIUM (visual enhancement, not critical path)

```bash
cd /home/laged/Codings/laged/bevy-demo/.worktrees/graphics-tilemap

# Implementation plan to create:
# - Arena tilemap background using TilemapChunk
# - Multiple colored arena zones (safe/danger/neutral)
# - Visual distinction via tinting and tile patterns
# - Performance benchmarks

# Key files:
# - src/domains/graphics/tilemap.rs (new)
# - src/entities/world.rs (integrate tilemap)
# - tests/tilemap_test.rs (new)

# Events to observe:
# - EnemySpawned (optional: highlight spawn zones)
```

**Estimated time**: 3-5 hours

---

### Step 3: UI Polish (After Widgets & Viewport Complete)

#### UI Agent - Phase 6: UI Polish

**Worktree**: `.worktrees/ui-polish`
**Priority**: LOW (refinement layer)
**Depends on**: ui-widgets and ui-viewport branches merged

```bash
cd /home/laged/Codings/laged/bevy-demo/.worktrees/ui-polish

# Implementation plan to create:
# - Gradient backgrounds for health bars
# - Val helper functions (px(), percent(), vw())
# - Text shadows for score/damage numbers
# - Responsive UI layout verification

# Key files:
# - src/domains/ui/hud.rs (refactor with gradients)
# - src/domains/ui/pause_menu.rs (polish styling)
# - src/domains/ui/settings_panel.rs (polish styling)
```

**Estimated time**: 2-3 hours

---

## Merge Strategy

### Merge Order (Sequential to Minimize Conflicts)

1. **gameplay-events** â†’ `bevy-0.17-features`
   - Provides event foundation
   - Other branches may need rebase after this merge

2. **ui-widgets** â†’ `bevy-0.17-features`
   - Introduces new UI components
   - Needed before polish phase

3. **ui-viewport** AND **graphics-tilemap** â†’ `bevy-0.17-features` (parallel)
   - Independent features
   - No expected conflicts

4. **ui-polish** â†’ `bevy-0.17-features`
   - Final refinement layer
   - Depends on widgets being in place

### Merge Commands

```bash
# From main repo (bevy-0.17-features branch)
cd /home/laged/Codings/laged/bevy-demo

# Merge 1: Gameplay events
git checkout bevy-0.17-features
git merge gameplay-events --no-edit
cargo test -- --nocapture  # Verify tests pass

# Merge 2: UI widgets
git merge ui-widgets --no-edit
cargo test -- --nocapture

# Merge 3: UI viewport (parallel with tilemap)
git merge ui-viewport --no-edit
cargo test -- --nocapture

# Merge 4: Graphics tilemap (parallel with viewport)
git merge graphics-tilemap --no-edit
cargo test -- --nocapture

# Merge 5: UI polish (last)
git merge ui-polish --no-edit
cargo test -- --nocapture

# Final verification
cargo build
cargo run  # Visual check
```

---

## Testing Agent Responsibilities

### Continuous Monitoring During Parallel Work

**Monitor these metrics for each branch:**

```bash
# Performance baseline check
cd /home/laged/Codings/laged/bevy-demo/.worktrees/<branch-name>
cargo test test_headless_app_creation -- --nocapture

# Verify: fps â‰¥ 15,000, frame time â‰¤ 67Âµs
```

**Run full test suite per commit:**

```bash
cargo test -- --nocapture
cargo check
cargo build
```

**Report regressions immediately** if any branch:
- Drops below 15k fps
- Introduces failing tests
- Has compiler warnings
- Shows merge conflicts with event contracts

---

## Implementation Plan Templates

### For UI Agent Sessions

When starting UI widget, viewport, or polish work, use this template:

**Phase 2: Headless Widgets**
```markdown
# UI Agent: Headless Widgets Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans

**Goal:** Implement pause menu and settings panel using Bevy 0.17 headless widgets

**Architecture:** Unstyled widget primitives (Button, Slider) with observer integration

**Tech Stack:** Bevy 0.17 UI (Button, Slider, Checkbox, RadioButton), headless testing

**Worktree:** `.worktrees/ui-widgets` (branch: `ui-widgets`)

---

### Task 1: Pause Menu with Button Widgets

**Files:**
- Create: `src/domains/ui/pause_menu.rs`
- Modify: `src/domains/ui/mod.rs` (add pub mod pause_menu)
- Test: `tests/pause_menu_test.rs` (new)

**Step 1: Write failing test for pause button**
[Detailed test code with Button widget]

**Step 2: Run test to verify it fails**
[cargo test command]

**Step 3: Implement pause menu with Button**
[Full implementation with observer pattern]

**Step 4: Run test to verify it passes**
[cargo test command]

**Step 5: Commit**
[git commands with descriptive commit message]

[Continue with Settings Panel, Wave Selector, Visual Styling, Integration tests]
```

**Phase 3: ViewportNode**
```markdown
# UI Agent: ViewportNode Integration Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans

**Goal:** Implement minimap and wave preview using ViewportNode

**Architecture:** Camera2d rendering into UI nodes via ViewportNode component

**Tech Stack:** Bevy 0.17 UI (ViewportNode), Camera2d, headless testing

**Worktree:** `.worktrees/ui-viewport` (branch: `ui-viewport`)

---

### Task 1: Minimap Camera System

**Files:**
- Create: `src/domains/ui/minimap.rs`
- Modify: `src/domains/ui/hud.rs` (integrate minimap)
- Test: `tests/minimap_test.rs` (new)

[TDD cycle: test â†’ fail â†’ implement â†’ pass â†’ commit]
```

**Phase 6: UI Polish**
```markdown
# UI Agent: UI Polish Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans

**Goal:** Apply visual polish using Bevy 0.17 gradients, Val helpers, text shadows

**Architecture:** Refactor existing UI code with new Bevy 0.17 UI APIs

**Tech Stack:** Bevy 0.17 UI (BackgroundGradient, px(), TextShadow)

**Worktree:** `.worktrees/ui-polish` (branch: `ui-polish`)

---

### Task 1: Gradient Health Bars

**Files:**
- Modify: `src/domains/ui/hud.rs:120-150` (health bar rendering)
- Test: `tests/ui_gradients_test.rs` (new)

[TDD cycle: test â†’ fail â†’ implement â†’ pass â†’ commit]
```

### For Graphics Agent Session

**Phase 4: Tilemap Expansion**
```markdown
# Graphics Agent: Tilemap Expansion Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans

**Goal:** Implement arena background using TilemapChunk with colored zones

**Architecture:** Chunked tilemap rendering with per-tile tinting for zone differentiation

**Tech Stack:** Bevy 0.17 Assets (TilemapChunk), headless testing

**Worktree:** `.worktrees/graphics-tilemap` (branch: `graphics-tilemap`)

---

### Task 1: Basic Tilemap Chunk Creation

**Files:**
- Create: `src/domains/graphics/tilemap.rs`
- Modify: `src/entities/world.rs` (integrate tilemap)
- Test: `tests/tilemap_test.rs` (new)

**Step 1: Write failing test for tilemap chunk**
```rust
#[test]
fn test_tilemap_chunk_creation() {
    let mut app = create_headless_app(config);
    // Spawn tilemap chunk
    // Verify exists in world
}
```

[Continue with colored zones, tinting, performance benchmarks]
```

---

## Success Criteria (All Branches)

### Per-Branch Checklist

Before merging ANY branch to `bevy-0.17-features`:

- [ ] All tests passing
- [ ] Performance â‰¥15k fps (headless)
- [ ] No compiler warnings
- [ ] Domain ownership headers on all files
- [ ] Domain README updated
- [ ] Rebased on latest bevy-0.17-features
- [ ] No merge conflicts with event contracts
- [ ] Visual verification in standard mode (cargo run)

### Overall Project Success

When all 5 branches merged to `bevy-0.17-features`:

ðŸŽ¯ **Functionality:**
- Pause menu works (widgets + GameState transitions)
- Settings panel adjusts game parameters
- Minimap shows real-time arena overview
- Arena zones visually distinct (tilemap)
- All events use Trigger/Observer pattern
- UI polish applied (gradients, Val helpers, text shadows)

ðŸŽ¯ **Performance:**
- Maintains â‰¥15k fps in headless tests
- No frame time regressions
- Visual mode runs smoothly at 60 fps

ðŸŽ¯ **Architecture:**
- Domain boundaries respected
- All cross-domain communication via events (core/events.rs)
- Backward compatibility maintained
- ARCHITECTURE.md rules followed

---

## Quick Reference Commands

### Start New Agent Session

```bash
# 1. Navigate to worktree
cd /home/laged/Codings/laged/bevy-demo/.worktrees/<branch-name>

# 2. Open Claude Code in this directory
# (new session automatically uses this as working directory)

# 3. Load and execute plan
# In Claude Code: /superpowers:execute-plan
# Provide plan path: docs/plans/2025-10-27-<agent-name>-plan.md
```

### Check Branch Status

```bash
# From any worktree
git status
git log --oneline -5
cargo test -- --nocapture
```

### Performance Baseline Check

```bash
cargo test test_headless_app_creation -- --nocapture | grep "fps"
# Should see: fps â‰¥ 15,000
```

### Merge Preparation

```bash
# Before merging, from worktree
git fetch origin
git rebase bevy-0.17-features
cargo test -- --nocapture
```

---

## Timeline Estimate

**Pre-Work (Event Contracts)**: 1-2 hours
- Gameplay Agent Task 0: Define all events in core/events.rs

**Parallel Work Phase**:
- Gameplay Agent (solo): 4-6 hours
- UI Agent Phase 2 (parallel): 4-6 hours
- UI Agent Phase 3 (parallel): 3-4 hours
- Graphics Agent (parallel): 3-5 hours

**Integration Phase**: 2-3 hours
- Merge all branches
- Resolve conflicts
- Final testing

**UI Polish (after integration)**: 2-3 hours
- UI Agent Phase 6

**Total Elapsed Time** (with parallelization): ~10-15 hours
**Total Effort** (serial equivalent): ~18-26 hours

---

## Notes

**For agents working in parallel:**
1. Gameplay Agent MUST complete Task 0 (event contracts) before others start
2. UI Agent can work on Phases 2 & 3 simultaneously (separate sessions)
3. Graphics Agent can start anytime after Gameplay Agent Task 0 complete
4. UI Polish Phase 6 should wait for Phases 2 & 3 to merge first
5. All agents commit frequently (after each passing test)
6. Testing Agent monitors all branches for regressions

**Event contracts are frozen** after Gameplay Agent Task 0 commits them. Do not modify event definitions without coordinating via new design document.

**Worktrees are isolated** - each agent has their own build directory, dependencies, and git branch. No conflicts between agents during work phase.
